<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <title>Document</title>
</head>
<body>

<div class="main">

    <div class="container text-center">



        <ul class="list-group list-group-horizontal-xl">
            {% for category in categories %}
            <li class="list-group-item">
                <a type="button" class="btn" data-mdb-ripple-color="dark" href="{%url 'showProducts'%}?category={{category.name}}">
                    {{category.name}}
                </a>
            </li>
            {% endfor %}
        </ul>


        <div class="row row-cols-1">
            {%for product in products %}
            <div class="col">
                <div class="card p-3">
                    <div class=" justify-content-between align-items-center ">
                        <div class="image">
                            <img src={{product.path.url}}
                                 width="300">
                        </div>
                        <div class="mt-1">
                            <div class="mt-1">
                                <h5 class="text-uppercase mb-2">{{product.name}}</h5>
                            </div>
                        </div>
                    </div>
                    <p>{{prodcut.description}}</p>
                    <div class="mb-2">
                        <select product_id="{{product.id}}" class="form-select size" aria-label="Choose size"
                                onchange="getSize('{{product.id}}')">
                            <option selected="">Choose size</option>
                            {%for size in product.size.all%}
                            <option value="{{size.price}}">{{size.name}}</option>
                            {% endfor %}
                        </select>
                        <select product_id="{{product.id}}" class="form-select mt-3 mb-2 extra"
                                aria-label="Choose extra" onchange="getSize('{{product.id}}')">

                            {%for extra in product.extra.all%}
                            <option value={{extra.price}}>{{extra.name}}</option>
                            {% endfor %}
                        </select></div>

                    <button class="btn btn-danger" product_id="{{product.id}}">Buy
                        <span class="price"></span>$
                    </button>
                </div>

            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    let tg = window.Telegram.WebApp;
    let buy = document.getElementById("buy");

    function getSize(product_id) {
        price = 0
        objectSize = $(`.size[product_id="${product_id}"]`)
        sizeSelected = objectSize.find(":selected")
        console.log(objectSize)
        size = sizeSelected.text()
        price += Number(sizeSelected.val())

        objectExtra = $(`.extra[product_id="${product_id}"]`)
        extraSelected = objectExtra.find(":selected")
        extraValue = extraSelected.text()

        allPrice = Number(price) + (Number(price) / 100 * Number(extraSelected.val()))

        refreshPrice(product_id, allPrice)
    }


    function refreshPrice(product_id, price = 0) {
        btn = $(`.btn[product_id="${product_id}"] > span`)
        btn.text(Number(price))
    }


</script>
</body>
</html>
